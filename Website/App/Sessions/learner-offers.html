<h3 class="page-header">{{pageTitle}}</h3>

<div class="row">
    <div class="col-md-4">
        <div class="row">
            <div class="col-sm-6">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <ul class="list-unstyled">
                            <li><a href="#/schedule">Schedule</a></li>
                            <li>Offers</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div data-ui-calendar="vm.calConfig" data-ng-model="vm.eventSources" data-calendar="calObj"></div>
        <div class="alert alert-info" ng-show="vm.selectedUser">Click the offer on the schedule to request a session.</div>
    </div>

    <div class="col-md-8">

        <div class="row">
            <div class="col-sm-4">
                <p class="input-group">
                    <input type="text" class="form-control"
                           data-datepicker-popup="d MMMM yyyy" data-ng-model="vm.date" data-is-open="vm.datepickerOpened" data-min="vm.minDate" data-max="vm.maxDate"
                           data-ng-change="vm.resetCal()" placeholder="Select date" />
                    <span class="input-group-btn">
                        <button class="btn btn-default" ng-click="vm.openDatepicker($event)"><i class="fa fa-calendar fa-fw" style="font-size:14px;"></i></button>
                    </span>
                </p>
            </div>
            <div class="col-sm-3">
                <select class="form-control app-time-select" style="font-family: monospace;"
                        data-ng-model="vm.startHour" data-ng-options="h.sh as h.t for h in vm.hoursStart" data-ng-change="vm.onFilterStartChange()">
                    <option value="">From hour</option>
                </select>
            </div>
            <div class="col-sm-3">
                <select class="form-control app-time-select" style="font-family: monospace;"
                        data-ng-model="vm.endHour" data-ng-options="h.sh as h.t for h in vm.hoursEnd" data-ng-change="vm.resetCal()">
                    <option value="">To hour</option>
                </select>
            </div>
        </div>

        <button class="btn btn-default btn-primary" data-ng-click="vm.search()" data-ng-disabled="!vm.canSearch()">Search offers</button>

        <div data-ng-show="vm.users.length == 0">
            <br />
            Nobody is available on Skype during the specified time period. Please try another period.
        </div>

        <div class="row" data-ng-repeat="u in vm.users">
            <div class="row"><div class="col-md-12"><hr class="app-separator" /></div></div>
            <div class=" col-md-offset-1 col-md-3">
                <strong>{{u.displayName}}</strong>
                <br />
                Session rate: {{u.sessionRate | number:2}} $/hour
                <br />
                <a href="" data-ng-click="vm.viewSchedule(u)">View schedule</a>
                <br />
                <a href="" data-ng-click="vm.openSessionRequestModal(u)">Request session</a>
                <br />
            </div>
            <div class="col-md-8">
                <span style="white-space: pre-line;">{{(isVisible ? u.announcement : (u.announcement | limitTo:300)) + '\u00A0\u00A0\u00A0'}}</span>
                <a href="" data-ng-click="isVisible = !isVisible">{{isVisible ? 'Less...' : 'More...'}}</a>
            </div>
        </div>

    </div>
</div>

<!-- Modals -->
<script type="text/ng-template" id="sessionRequestModal.html">
    <div class="modal-header">
        <h3>Request Session</h3>
    </div>
    <div class="modal-body">
        <div class="row">
            <div class="col-md-offset-1 col-md-10">
                <p>Request a Skype session with <strong>{{vm.user.displayName}}</strong></p>
                <br/>
                <p>Current time: {{vm.now | appDate}}</p>
                <div class="form-group">
                    <label for="startDropdown">Start time</label>
                    <div class="dropdown">
                        <a class="dropdown-toggle" id="startDropdown" role="button" data-toggle="dropdown" data-target="#" href="javascript:;">
                            <div class="input-group">
                                <input type="text" class="form-control" data-ng-model="vm.start">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                            </div>
                        </a>
                        <ul class="dropdown-menu" role="menu">
                            <datetimepicker data-ng-model="vm.start" data-datetimepicker-config="{ dropdownSelector: '#startDropdown', minuteStep: 5 }" data-ng-required="true" />
                        </ul>
                    </div>
                </div>
                <div class="form-group">
                    <label for="durationInput">Duration</label>
                    <select class="form-control" id="durationInput" ng-model="vm.duration" ng-options="i.span as i.text for i in vm.durations"></select>
                </div>
                <div class="form-group">
                    <label for="messageTextarea">Your message for the session</label>
                    <textarea class="form-control" id="messageTextarea" ng-model="vm.message" maxlength="1000" />
                </div>
                The session price is {{vm.getPrice() | currency:"$"}}
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" data-ng-click="vm.save()" data-ng-disabled="!vm.canSave()">OK</button>
        <button class="btn" data-ng-click="vm.cancel()">Cancel</button>
    </div>
</script>
<!-- /Modals -->
